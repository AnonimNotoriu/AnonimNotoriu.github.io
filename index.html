<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <script src="loader.js"></script>
  <script type="text/javascript">
  loadScript("https://cdn.steemjs.com/lib/latest/steem.min.js", function(){
  loadScript("https://cdn.jsdelivr.net/remarkable/1.7.1/remarkable.min.js", function(){
    var steemusername = 'ausbitbank';
    var showresteems = true;
    var redirect = sessionStorage.redirect;
    delete sessionStorage.redirect;
    var md = new Remarkable({html:true,breaks:true,linkify:true,typographer:true});
    var c = document.getElementById("content");
    var t = document.getElementById("title");
    if (redirect && redirect != location.href) {
      history.replaceState(null, null, redirect);
      link = redirect.split('/')
      permlink = link[3]
      console.log("loading "+permlink);
      steem.api.getContent(steemusername, permlink, function(err, result) {
        console.log(err, result);
        document.title=result['title'];
        var postcontent = md.render(result['body']);
        t.innerHTML='<h1>'+result['title']+'</h1>';
        c.innerHTML=postcontent;
      });
    } else {
      steem.api.getState('/@'+steemusername, function(err, result) {
        console.log(err, result);
        document.getElementById("title").innerHTML='<h1>Recent posts by '+steemusername+'</h1>';
        for(var i=0;i<result['accounts'][steemusername]['blog'].length;i++){
          console.log(result['accounts'][steemusername]['blog'][i]);
          var handle = result['accounts'][steemusername]['blog'][i].split('/');
          var postauthor = handle[0];
          var postpermlink = handle[1];
          if (postauthor != steemusername && showresteems == false) {
            console.log("skipping resteem from "+postauthor);
            break;
          }
          console.log(result['content'][postauthor+'/'+postpermlink]['title']);
          c.innerHTML+= '<span class="postitle"><a href="" onClick="loadpost(\''+postauthor+'\\'+postpermlink+'\')">'+result['content'][postauthor+'/'+postpermlink]['title']+'</a></span>';
        }
      });
    }
  });
  });
  </script>
  <style>
    #title {}
    #content {}
    .posttitle {clear:both;}
  </style>
</head>
<body>
  <div id="container">
    <div id="title"></div>
    <div id="content"></div>
  </div>
</body>
</html>
